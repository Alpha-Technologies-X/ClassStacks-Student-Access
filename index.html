<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Stacks - Student Browser</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --danger: #e63946;
            --success: #2a9d8f;
            --dark: #212529;
            --light: #f8f9fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fb;
            color: var(--dark);
        }
        
        .auth-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .auth-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .logo {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5ee;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .browser-screen {
            display: none;
            height: 100vh;
            flex-direction: column;
        }
        
        .browser-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .student-info {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .browser-controls {
            display: flex;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            gap: 15px;
            align-items: center;
        }
        
        .url-input-container {
            flex: 1;
            display: flex;
            background: white;
            border: 2px solid #e1e5ee;
            border-radius: 25px;
            overflow: hidden;
        }
        
        .url-input {
            flex: 1;
            padding: 12px 20px;
            border: none;
            font-size: 16px;
        }
        
        .go-button {
            padding: 12px 25px;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
        }
        
        .browser-content {
            flex: 1;
            background: white;
        }
        
        .home-screen {
            padding: 40px;
            text-align: center;
        }
        
        .website-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        
        .website-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .website-item:hover {
            border-color: var(--primary);
        }
        
        .website-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .blocked-message {
            display: none;
            background: #ffebee;
            color: #c62828;
            padding: 40px;
            text-align: center;
            height: 100%;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .browser-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .restriction-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px;
            text-align: center;
        }
        
        .message-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            max-width: 400px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Authentication Screen -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-box">
            <div class="logo">ðŸŽ“</div>
            <h1>Class Stacks</h1>
            <p style="color: #666; margin-bottom: 30px;">Student Browser</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="studentName">Your Name</label>
                    <input type="text" id="studentName" placeholder="Enter your name" required>
                </div>
                <div class="form-group">
                    <label for="classCode">Class Code</label>
                    <input type="text" id="classCode" placeholder="Enter class code" required>
                </div>
                <button type="submit" class="btn">Enter Browser</button>
            </form>
            
            <div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px;">
                <strong>Demo:</strong> Name: <code>demo</code>, Code: <code>CS2024</code>
            </div>
        </div>
    </div>

    <!-- Browser Screen -->
    <div class="browser-screen" id="browserScreen">
        <div class="student-info">
            Student: <span id="studentNameDisplay">Unknown</span>
            <button onclick="logout()" style="margin-left: 10px; padding: 3px 8px; background: var(--danger); color: white; border: none; border-radius: 10px; font-size: 0.7rem;">Exit</button>
        </div>
        
        <div class="browser-header">
            <h2>Class Stacks Browser</h2>
            <p>Teacher Monitored â€¢ Safe Browsing</p>
        </div>
        
        <div class="browser-controls">
            <div class="url-input-container">
                <input type="text" class="url-input" id="urlInput" placeholder="Enter website URL (e.g., google.com, wikipedia.org)">
                <button class="go-button" onclick="navigateToUrl()">Go</button>
            </div>
            <button class="btn" onclick="goHome()" style="width: auto; padding: 12px 20px;">Home</button>
        </div>
        
        <div class="browser-content" id="browserContent">
            <div class="home-screen" id="homeScreen">
                <h2>Welcome to Class Stacks Browser!</h2>
                <p>Type any website URL above or click on a website below to get started.</p>
                
                <div id="restrictionNotice" class="restriction-notice" style="display: none;">
                    <h4>ðŸ”’ Restricted Mode Active</h4>
                    <p>Your teacher has enabled website restrictions for educational purposes.</p>
                </div>
                
                <div style="margin: 30px 0;">
                    <h4>Try these websites:</h4>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 15px;">
                        <button class="btn" onclick="visitWebsite('google.com')" style="width: auto;">Google</button>
                        <button class="btn" onclick="visitWebsite('wikipedia.org')" style="width: auto;">Wikipedia</button>
                        <button class="btn" onclick="visitWebsite('khanacademy.org')" style="width: auto;">Khan Academy</button>
                        <button class="btn" onclick="visitWebsite('youtube.com')" style="width: auto;">YouTube</button>
                    </div>
                </div>
            </div>
            
            <div class="blocked-message" id="blockedMessage">
                <div style="font-size: 4rem; margin-bottom: 20px;">ðŸš«</div>
                <h2>Website Blocked</h2>
                <p>This website has been restricted by your teacher.</p>
                <p id="blockedUrl" style="font-family: monospace; margin: 15px 0; font-size: 1.1rem;"></p>
                <button class="btn" onclick="goHome()" style="width: auto; margin-top: 20px;">Return to Safety</button>
            </div>
            
            <iframe class="browser-frame" id="browserFrame" style="display: none;"></iframe>
        </div>
    </div>

    <!-- Message Notification -->
    <div class="message-notification" id="messageNotification">
        <h4>ðŸ“© Message from Teacher</h4>
        <p id="messageText"></p>
        <button class="btn" onclick="closeMessage()" style="width: auto; margin-top: 10px;">OK</button>
    </div>

    <script>
        const CLASS_CODE = "CS2024";
        let currentStudent = null;
        let studentId = null;
        let isRestricted = false;

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const studentName = document.getElementById('studentName').value;
            const classCode = document.getElementById('classCode').value;
            
            if (classCode.toUpperCase() !== CLASS_CODE) {
                alert('Invalid class code! Please use: ' + CLASS_CODE);
                return;
            }
            
            // Create unique student ID
            studentId = 'student_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
            currentStudent = {
                id: studentId,
                name: studentName,
                classCode: classCode,
                lastActive: Date.now(),
                currentUrl: '',
                device: getDeviceType()
            };
            
            showBrowser();
            startActivityReporting();
        });

        // Show browser interface
        function showBrowser() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('browserScreen').style.display = 'flex';
            document.getElementById('studentNameDisplay').textContent = currentStudent.name;
            updateStudentData();
        }

        // Get device type
        function getDeviceType() {
            const ua = navigator.userAgent;
            if (/Mobile|Android|iPhone|iPad/.test(ua)) return 'Mobile';
            return 'Desktop';
        }

        // Update student data in shared storage
        function updateStudentData() {
            const data = getSharedData();
            data.students = data.students || {};
            data.students[studentId] = {
                ...currentStudent,
                lastActive: Date.now()
            };
            saveSharedData(data);
        }

        // Get shared data
        function getSharedData() {
            return JSON.parse(localStorage.getItem('classStacksData') || '{"students":{},"blockedSites":[],"restrictedStudents":{}}');
        }

        // Save shared data
        function saveSharedData(data) {
            data.lastUpdated = Date.now();
            localStorage.setItem('classStacksData', JSON.stringify(data));
        }

        // Start activity reporting
        function startActivityReporting() {
            setInterval(() => {
                updateStudentData();
                checkRestrictions();
                checkForMessages();
            }, 2000);
        }

        // Check if student is restricted
        function checkRestrictions() {
            const data = getSharedData();
            isRestricted = data.restrictedStudents && data.restrictedStudents[studentId];
            
            const notice = document.getElementById('restrictionNotice');
            if (isRestricted) {
                notice.style.display = 'block';
            } else {
                notice.style.display = 'none';
            }
        }

        // Visit website
        function visitWebsite(url) {
            document.getElementById('urlInput').value = url;
            navigateToUrl();
        }

        // Navigate to URL
        function navigateToUrl() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) return;

            const fullUrl = url.startsWith('http') ? url : 'https://' + url;
            const domain = extractDomain(fullUrl);

            // Check if blocked
            if (isRestricted && isUrlBlocked(domain)) {
                showBlockedMessage(domain);
                return;
            }

            // Show in iframe
            showWebsite(fullUrl);
            currentStudent.currentUrl = domain;
            updateStudentData();
        }

        // Extract domain from URL
        function extractDomain(url) {
            try {
                return new URL(url).hostname.replace('www.', '');
            } catch {
                return url;
            }
        }

        // Check if URL is blocked
        function isUrlBlocked(domain) {
            const data = getSharedData();
            const blockedSites = data.blockedSites || [];
            return blockedSites.some(site => domain.toLowerCase().includes(site.toLowerCase()));
        }

        // Show blocked message
        function showBlockedMessage(url) {
            document.getElementById('homeScreen').style.display = 'none';
            document.getElementById('browserFrame').style.display = 'none';
            document.getElementById('blockedMessage').style.display = 'flex';
            document.getElementById('blockedUrl').textContent = url;
            
            currentStudent.currentUrl = 'BLOCKED: ' + url;
            updateStudentData();
        }

        // Show website in iframe
        function showWebsite(url) {
            document.getElementById('homeScreen').style.display = 'none';
            document.getElementById('blockedMessage').style.display = 'none';
            document.getElementById('browserFrame').style.display = 'block';
            document.getElementById('browserFrame').src = url;
        }

        // Go to home screen
        function goHome() {
            document.getElementById('homeScreen').style.display = 'block';
            document.getElementById('blockedMessage').style.display = 'none';
            document.getElementById('browserFrame').style.display = 'none';
            document.getElementById('urlInput').value = '';
            
            currentStudent.currentUrl = '';
            updateStudentData();
        }

        // Check for messages from teacher
        function checkForMessages() {
            const data = getSharedData();
            if (data.messages && data.messages[studentId]) {
                const messages = data.messages[studentId];
                if (messages.length > 0) {
                    const latestMessage = messages[messages.length - 1];
                    showMessage(latestMessage.text);
                    // Clear messages after showing
                    data.messages[studentId] = [];
                    saveSharedData(data);
                }
            }
        }

        // Show message
        function showMessage(text) {
            document.getElementById('messageText').textContent = text;
            document.getElementById('messageNotification').style.display = 'block';
        }

        // Close message
        function closeMessage() {
            document.getElementById('messageNotification').style.display = 'none';
        }

        // Logout
        function logout() {
            const data = getSharedData();
            if (data.students && data.students[studentId]) {
                delete data.students[studentId];
                saveSharedData(data);
            }
            
            document.getElementById('browserScreen').style.display = 'none';
            document.getElementById('authScreen').style.display = 'flex';
            document.getElementById('loginForm').reset();
            currentStudent = null;
            studentId = null;
        }

        // Handle Enter key in URL input
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                navigateToUrl();
            }
        });

        // Initialize
        goHome();
    </script>
</body>
</html>
